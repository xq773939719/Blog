---
title: 计算机网络浅谈
categories: 
- [技术]
tags: [网络, HTTP, HTTPS]
copyright: true
comments: true
top: false
author: XQ
mathjax: false
date: 2020-12-03 14:24:24
updated: 2020-12-03 14:24:27
keywords: 计算机网络
description: 
passwords:
img: 
abstract: 网络
---

# 1. HTTP HTTPS

### 什么是HTTP HTTPS？

Hyper Text Transfer Protocal 超文本传输协议，是实现数据通信的基石

HTTP协议用于客户端和服务端之间的通信，通过请求和响应的交互达成通信（肯定是先从客户端开始建立通信的，服务器端在没有接收到任何请求之前不会发送响应）

HTTP是无状态的协议，为了实现期望的保存状态的功能，引入了Cookie技术

请求服务器的方法 `post get put head delete options trace connect`

```markdown
GET 请求资源，服务器解析后返回数据，数据在URL可见，直接传输不安全，记得转码
POST 传输实体数据，安全，数据在请求体里面
× PUT 传输文件，鉴于HTTP／1.1的PUT方法自身不带验证机制，任何人都可以上传文件，存在安全性问题，因此一般的网站不建议使用该方法。若配合Web应用程序的验证机制，或架构设计采用REST标准的同类Web网站，就可能会开放使用PUT方法。
HEAD 同GET类似，只是为了获得报文首部，用于确认URL有效性以及更新日期
× DELETE 和PUT一样不带验证
OPTIONS 查询针对请求URL指定的资源支持的方法
TRACE 追踪路径，客户端通过TRACE方法可以查询发送出去的请求是怎样被加工修改／篡改的。这是因为，想要连接到源目标服务器可能会通过代理中转，TRACE方法就是用来确认连接过程中发生的一系列操作。
CONNECT  要求用隧道协议连接代理。CONNECT方法在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容经网络隧道传输。
```

无连接 无状态如何解决？

keep-alive 只要任意一端没有提出断开连接，则保持TCP连接。管线化，持久连接促进管线化，不必等待下一次请求，就可以发送多个响应。

cookie 通过在请求和响应报文中写入cookie信息来控制客户端状态。

返回结果的HTTP状态码

- 1XX 表示服务器已经接收了客户端请求，客户端可继续发送请求
- 2XX 请求正常处理完毕
- 3XX 需要进行附加操作以完成请求
- 4XX 表示客户端的请求有非法内容
- 5XX 服务器处理请求出错

通信数据转发程序：代理、网关、隧道

使用代理服务器的理由：利用缓存技术减少网络带宽的流量。代理有多种使用方法，按两种基准分类。一类是 **是否使用缓存** ，另一种是 **是否会修改报文**。

利用网关可以由HTTP请求转化为其他协议通信。

利用缓存可减少对源服务器的访问，可以节省通信流量和通信时间。
使用缓存的时候，要注意缓存的有效期限，确保我们发起请求获取的是最新的数据资源。

> HTTP 有以下不足：
>
> - 通信使用明文（不加密），内容可能会被窃听
> - 不验证通信方的身份，因此有可能遭遇伪装
> - 无法证明报文的完整性，所以有可能已遭篡改
>
> HTTP + 加密 + 认证 + 完整性 = HTTPS
>
> HTTPS并非是应用层的一种新协议。只是HTTP通信接口部分用SSL和TSL协议代替而已，通常，HTTP直接和TCP通信，当使用SSL时，则演变成先和SSL通信，再由SSL和TCP通信了。简言之，所谓HTTPS其实就是身披SSL协议这层外壳的HTTP。
>
> 当采用SSL后，HTTP就拥有了HTTPS的加密、证书和完整性保护这些功能。而且SSL协议是独立于HTTP的协议，所以不光是HTTP协议，其他运行在应用层的SMTP和Telnet等协议均可配合SSL协议使用。可以说SSL是当今世界上应用最为广泛的网络安全技术。
>
> 在讲解SSL之前我们需要首先了解一下加密方法，加密分为对称加密和非对称加密。HTTPS协议则是采用的两者混合的实现方式，为什么要结合两种的实现方式呢？这是因为它们都各自存在自己的优缺点。对于对称加密来说，密钥的传输交换是不安全的，但是效率比较高，而对于非对称加密，是不用担心传输的密钥安全性的问题的，因为我们传递的是公开密钥，任何人都可以获得，但是缺点是效率比较低。对于公钥私钥、数字签名，这个哥们已经总结的相当好了，可以参考一下这篇[文章](http://www.cnblogs.com/f1194361820/archive/2015/01/29/4260025.html)。

### 为什么需要加密

http内容是明文传输的，明文数据经过中间代理服务器、路由，如果信息在传输过程中被劫持，内容将会是完全暴露的，甚至可以篡改，这称为中间人攻击。

### 对称加密

一段密钥代码，它可以解密原本的内容。

获取信息的一方持有这个密钥才能和解密获得信息。

### 只有对称加密可行吗

如果通信双方本来就持有密钥，安全性没问题，密钥怎么来的，肯定是浏览器发出请求，服务器响应，告诉双方“你用这个密钥解密”，这样就完全把密钥暴露在外，还是不安全的。

### 非对称加密

公钥内容用私钥解，私钥内容用公钥解，耗时

### 非对称与对称结合

首先，服务器持有公钥A，私钥A，明文传送公钥A传送到客户端，客户端网站生成密钥a，使用服务器的公钥A加密密钥a发送报文到服务端，服务端接受报文并使用密钥A解密得到密钥a，这样的密钥a看似是安全的，双方可以使用密钥a加密解密。但是，如果明文传送的公钥A被中间人获取，并生成密钥α，使用公钥A加密α发送报文，这样双方都获得了α，使用α加密解密，中间人就使用α密钥攻击服务器了。

发生这种情况的原因是服务器收到返回的加密后的密钥a/α，它不知道是不是自己网站产生的密钥。

如何证明是客户端发送请求并且是客户端收到公钥并且是客户端生成密钥a使用公钥A加密后返回的？

- 公信机构，提供证明，例如数字证书，服务器发送网站HTTPS信息前需要申请数字证书，证书存有持有者、持有者公钥、证书对应网址等信息，传数字证书给浏览器，标记此证书对应此网站，浏览器从证书取公钥就好了，不用明文传送公钥。

- 那证书万一被篡改呢？给证书加个防伪标志，数字签名：使用证书内容生成一份签名，比对证书内容和签名是否一致。

- CA数字签名制作（因为公信机构CA拥有服务端公钥私钥，CA对证书明文信息hash，hash使用私钥加密，得到数字签名）。
- 证书明文和数字签名共同组成数字证书。颁发给网站。
- 那浏览器如何验证是不是此网站的证书？浏览器使用CA机构的公钥解密签名，并通过证书明文计算签名，对比是否相等，相等则验证成功。



具体过程如下：获取颁发证书，校验证书是否是CA颁发，服务器响应请求

```

                          CA机构→→2→→→证书明文与证书哈希后私钥加密
                            ↑                   ↓
                            ↑	 (服务器有CA私钥)   ↓
                            1		   (取证书)  	  3
(浏览器校验证书是否被替换)    某网站								  ↓
浏览器→→→→→HTTPS请求→→→→→→→→服务器←←←←←←4←←←←←←←带签名的证书
(证书)←←←←←←←←←签名证书←←←←←← ↓ ↑
  →用证书公钥加密客户端密钥→→→→ ↓ ↑ 使用私钥解密客户端密钥存储sessionID
 （建立了安全的连接）          5  6   
 每次使用客户端密钥加密发送信息← ↓ ↑ 					(校验)
 →每次使用服务端公钥加密发送信息 ↓ ↑	
                            验证
                               → {用证书的公钥解密签名得到明文的哈希值}
                               → {使用哈希函数处理证书明文得到哈希值}
                               → {对比哈希值}
                               → 如果相等，安全，没有被篡改
                               → 如果不等，证书被篡改
       (请求与响应)


```

加密解密的过程在分层网络模型中处于TCP之上的SSL/TSL层

# 2. 常见的字段是什么？
Host x.x.x 请求地址
content-length 响应数据长度
content-type 响应数据格式
content-encoding 数据压缩格式
connection 用于保持长连接
accept 声明接受的数据格式
accept-encoding 可接受的压缩格式


# 参考

[彻底搞懂HTTPS的加密机制](https://zhuanlan.zhihu.com/p/43789231)

[彻底搞懂HTTP协议](http://www.akathink.com/2016/07/28/彻底搞懂HTTP协议/)

[彻底搞懂HTTP和HTTPS协议](https://liyucang-git.github.io/2019/01/02/彻底搞懂HTTP和HTTPS协议/)

[彻底弄懂HTTP缓存机制及原理](https://www.cnblogs.com/chenqf/p/6386163.html)

[Java Security：公钥私钥、数字签名、消息摘要是什么](https://www.cnblogs.com/f1194361820/p/4260025.html)

[ssl/tls是什么？是怎么工作的？](https://zhuanlan.zhihu.com/p/53329356)



# 2. XSS CSRF
xss：用户过分信任网站，放任来自浏览器地址栏代表的那个网站代码在自己本地任意执行。如果没有浏览器的安全机制限制，xss代码可以在用户浏览器为所欲为；

csrf：网站过分信任用户，放任来自所谓通过访问控制机制的代表合法用户的请求执行网站的某个特定功能。